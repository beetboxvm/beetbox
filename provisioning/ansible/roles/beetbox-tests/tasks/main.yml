---
- name: Test ansible is running as beet_user.
  shell: >
    whoami
  register: beet_ansible_user
  become: no
  changed_when: false
  failed_when: beet_ansible_user.stdout != beet_user

- name: Test webserver is responding on port 80.
  uri:
    url: "http://{{ beet_domain }}/"
    status_code: 200

- name: Test webserver is responding on port 443.
  uri:
    url: "https://{{ beet_domain }}/"
    validate_certs: no
    status_code: 200

- name: Test mailhog is responding on port 8025.
  uri:
    url: "http://{{ beet_domain }}:8025/"
    status_code: 200

- name: Test xdebug is available.
  shell: >
    php -m
  register: php_modules
  changed_when: false
  failed_when: "'xdebug' not in php_modules.stdout"

- name: Test uploadprogress is available.
  shell: >
    php -m
  register: php_modules
  changed_when: false
  failed_when: "'uploadprogress' not in php_modules.stdout"

- name: Test adminer is responding on port 80.
  uri:
    url: "http://adminer.{{ beet_domain }}/"
    status_code: 200
