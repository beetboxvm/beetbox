---
- set_fact:
    php_ppa: ppa:ondrej/php
  when: php_version == '5.5' or php_version == '5.6' or php_version == '7.0'

- name: Add repository for PHP.
  apt_repository:
    repo: "{{ php_ppa }}"
    update_cache: yes

- name: Purge PHP version packages.
  apt:
    name: "{{ item }}"
    state: absent
  when: "'php{{ php_version }}' != item"
  with_items:
    - php5.5
    - php5.6
    - php7.0

- name: Set PHP 5.5 packages.
  set_fact:
    php_packages: "{{ php55_packages }}"
  when: php_version == '5.5'

- name: Set PHP 5.6 packages.
  set_fact:
    php_packages: "{{ php56_packages }}"
  when: php_version == '5.6'

- name: Set PHP 7.0 packages.
  set_fact:
    php_packages: "{{ php70_packages }}"
  when: php_version == '7.0'

- name: Set default PHP7 mysql package.
  set_fact:
    php_mysql_package: php7.0-mysql
  when: (php_version == '7.0') and (php_mysql_package is not defined)

- name: Set default PHP7 fpm daemon.
  set_fact:
    php_fpm_daemon: php7.0-fpm
  when: (php_version == '7.0') and (php_fpm_daemon is not defined)

- name: Set default PHP7 fpm pool conf path.
  set_fact:
    php_fpm_pool_conf_path: "/etc/php/7.0/fpm/pool.d/www.conf"
  when: (php_version == '7.0') and (php_fpm_pool_conf_path is not defined)
